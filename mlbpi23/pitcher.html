<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, minimum-scale=1, initial-scale=1.0">
    <title>投手球種球速查詢</title>
    <link href="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.13.4/datatables.min.css" rel="stylesheet"/>
    <script src="https://cdn.datatables.net/v/dt/jq-3.6.0/dt-1.13.4/datatables.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.13.4/sorting/absolute.min.js"></script>
    <script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>
<style>
    body {
        font-family: monospace;
        margin: 0;
    }
    #example_filter {
        display: none;
    }
    select, input {
        width: 100%;
        border: 1px solid rgba(0, 0, 0, 0.15);
    }
    .sticky-element {
        position: sticky !important;
        top: 0 !important;
        background-color: #fff !important;
        box-shadow: 0 1px 3px #00000017;
        z-index: 20;
    }
    .dataTables_scrollHead {
        /* position: sticky !important; */
        /* top: 0 !important; */
        /* z-index: 20 !important; */
        /* background-color: #fff !important; */
        /* box-shadow: 0 1px 3px #00000017; */
    }
    tr>th:first-child, tr>td:first-child {
        position: sticky !important;
        left: 0;
        z-index: 10;
        background-color: #fff;
    }
    tbody tr>td:first-child {
        border-right: 1px solid rgba(0, 0, 0, 0.15);
    }
 </style>
<script>
    var headers = [];
    var columns = [];
    var dataSet = [];
    Papa.parse('data.csv?v=230620', {
        download: true,
        complete: function(results) {
            // console.log(results);
            headers = results.data.shift();
            headers.forEach(text => {
                columns.push({
                    title: text
                });
            });
            dataSet = results.data;
            init();
        }
    })

    function init() {
        var namesType = $.fn.dataTable.absoluteOrder([
		    { value: '', position: 'bottom' }
		]);
		
        var numbersType = $.fn.dataTable.absoluteOrderNumber([
            { value: '', position: 'bottom' }
        ]);
        
        var table = $('#example').DataTable({
            info: false,
            paging: false,
            // scrollX: true,
            // fixedHeader: true,
            // fixedColumns: true,
            orderCellsTop: true,
            columnDefs: [
                { orderSequence: ['desc', 'asc'], targets: '_all' },
                { type: namesType, targets: [4] },
                { type: numbersType, targets: [17,18,19,20,21,22,23,24,25,26,27,28,29] }
            ],
            data: dataSet,
            columns: columns,
            initComplete: function () {
                this.api()
                    .columns()
                    .every(function (colIndex) {
                        var column = this;

                        switch (colIndex) {
                            case 0:
                                // if (!mobileCheck()) {
                                    var input = $('<input type="text" name="filter_'+colIndex+'">')
                                        .appendTo($('#filters').find('td').eq(colIndex))
                                        .on('keyup change clear', function (e) {
                                            if (column.search() !== this.value) {
                                                column.search(this.value).draw();
                                            }
                                        });
                                    break;
                                // }
                            case 1:
                            case 2:
                            case 3:
                            case 4:
                            case 5:
                            case 6:
                            case 15:
                            case 16:
                                var select = $('<select name="filter_'+colIndex+'">><option value=""></option></select>')
                                    .appendTo($('#filters').find('td').eq(colIndex))
                                    .on('change', function () {
                                        var val = $.fn.dataTable.util.escapeRegex($(this).val());
                
                                        column.search(val ? '^' + val + '$' : '', true, false).draw();
                                    });
                                column
                                    .data()
                                    .unique()
                                    .sort()
                                    .each(function (d, j) {
                                        select.append('<option value="' + d + '">' + d + '</option>');
                                    });
                                break;
                            default:
                                break;
                        }
                    });
            },
        });
    }

    $(document).ready(function () {

        $('body').on('change', 'input, select', function (e) {
            // console.log(e.target, e.target.value)
            if (e.target.value && !e.target.readOnly && !e.target.disabled) {
                $(e.target).css('background-color', 'lightyellow');
            } else {
                $(e.target).css('background-color', '');
            }
        });

    });

</script>
</head>
<body>
    <table id="example" class="display nowrap" style="width:100%">
        <thead class="sticky-element">
            <tr>
                <th style="text-align: left;">Loading...</th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
                <th></th>
	    	<th></th>
                <th></th>
                <th></th>
            </tr>
            <tr id="filters">
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
                <td></td>
	    	<td></td>
                <td></td>
                <td></td>
            </tr>
        </thead>
        <tbody></tbody>
    </table> 
    <div style="text-align: center; margin: 10px 0;">- END -</div>
</body>
</html>
